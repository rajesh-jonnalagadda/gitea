{{if $.IsSplitStyle}}
	{{range $k, $line := $.section.Lines}}
	{{$inlineDiff := $.section.GetComputedInlineDiffFor $line ctx.Locale}}
	<tr class="{{.GetHTMLDiffLineType}}-code nl-{{$k}} ol-{{$k}} line-expanded">
		{{if eq .GetType 4}}
			{{$expandDirection := $line.GetExpandDirection}}
			<td class="lines-num lines-num-old" data-line-num="{{if $line.LeftIdx}}{{$line.LeftIdx}}{{end}}">
        		<div class="lines-comment">
        			<div>
        				{{if $line.SectionInfo.HasComments}}
        					<button>
        					  {{svg "octicon-comment-discussion"}}
        					</button>
        				{{end}}
        			</div>
        			<div class="code-expander-buttons" data-expand-direction="{{$expandDirection}}">
        				{{if or (eq $expandDirection 3) (eq $expandDirection 5)}}
        					<button class="code-expander-button" hx-target="closest tr" hx-get="{{$.RepoLink}}/blob_excerpt/{{PathEscape $.AfterCommitID}}?{{$line.GetBlobExcerptQuery}}&style=split&direction=down&wiki={{$.PageIsWiki}}&pull={{$.PageIsPullFiles}}&anchor={{$.Anchor}}&file_name={{$.section.FileName}}">
        					  {{svg "octicon-fold-down"}}
        					</button>
        				{{end}}
        			  	{{if or (eq $expandDirection 3) (eq $expandDirection 4)}}
        			  		<button class="code-expander-button" hx-target="closest tr" hx-get="{{$.RepoLink}}/blob_excerpt/{{PathEscape $.AfterCommitID}}?{{$line.GetBlobExcerptQuery}}&style=split&direction=up&wiki={{$.PageIsWiki}}&pull={{$.PageIsPullFiles}}&anchor={{$.Anchor}}&file_name={{$.section.FileName}}">
        			  		  {{svg "octicon-fold-up"}}
        			  		</button>
        			  	{{end}}
        			  	{{if eq $expandDirection 2}}
        			  		<button class="code-expander-button" hx-target="closest tr" hx-get="{{$.RepoLink}}/blob_excerpt/{{PathEscape $.AfterCommitID}}?{{$line.GetBlobExcerptQuery}}&style=split&direction=&wiki={{$.PageIsWiki}}&pull={{$.PageIsPullFiles}}&anchor={{$.Anchor}}&file_name={{$.section.FileName}}">
        			  		  {{svg "octicon-fold"}}
        			  		</button>
        			  	{{end}}
        			</div>
        		</div>
        	</td>
			<td colspan="7" class="lines-code lines-code-old ">{{$inlineDiff := $.section.GetComputedInlineDiffFor $line ctx.Locale}}{{/*
				*/}}{{template "repo/diff/section_code" dict "diff" $inlineDiff}}</td>
		{{else}}
			<td class="lines-num lines-num-old" data-line-num="{{if $line.LeftIdx}}{{$line.LeftIdx}}{{end}}"><span rel="{{if $line.LeftIdx}}diff-{{$.FileNameHash}}L{{$line.LeftIdx}}{{end}}"></span></td>
			<td class="lines-escape lines-escape-old">{{if and $line.LeftIdx $inlineDiff.EscapeStatus.Escaped}}<button class="toggle-escape-button btn interact-bg" title="{{template "repo/diff/escape_title" dict "diff" $inlineDiff}}"></button>{{end}}</td>
			<td class="lines-type-marker lines-type-marker-old">{{if $line.LeftIdx}}<span class="tw-font-mono" data-type-marker=""></span>{{end}}</td>
			<td class="lines-code lines-code-old">{{/*
				*/}}{{if and $.SignedUserID $.PageIsPullFiles}}{{/*
					*/}}<button type="button" aria-label="{{ctx.Locale.Tr "repo.diff.comment.add_line_comment"}}" class="ui primary button add-code-comment add-code-comment-{{if $line.RightIdx}}right{{else}}left{{end}}{{if (not $line.CanComment)}} tw-invisible{{end}}" data-side="{{if $line.RightIdx}}right{{else}}left{{end}}" data-idx="{{if $line.RightIdx}}{{$line.RightIdx}}{{else}}{{$line.LeftIdx}}{{end}}">{{/*
						*/}}{{svg "octicon-plus"}}{{/*
					*/}}</button>{{/*
				*/}}{{end}}{{/*
				*/}}{{if $line.LeftIdx}}{{template "repo/diff/section_code" dict "diff" $inlineDiff}}{{else}}{{/*
					*/}}<code class="code-inner"></code>{{/*
				*/}}{{end}}{{/*
			*/}}</td>
			<td class="lines-num lines-num-new" data-line-num="{{if $line.RightIdx}}{{$line.RightIdx}}{{end}}"><span rel="{{if $line.RightIdx}}diff-{{$.FileNameHash}}R{{$line.RightIdx}}{{end}}"></span></td>
			<td class="lines-escape lines-escape-new">{{if and $line.RightIdx $inlineDiff.EscapeStatus.Escaped}}<button class="toggle-escape-button btn interact-bg" title="{{template "repo/diff/escape_title" dict "diff" $inlineDiff}}"></button>{{end}}</td>
			<td class="lines-type-marker lines-type-marker-new">{{if $line.RightIdx}}<span class="tw-font-mono" data-type-marker=""></span>{{end}}</td>
			<td class="lines-code lines-code-new">{{/*
				*/}}{{if and $.SignedUserID $.PageIsPullFiles}}{{/*
					*/}}<button type="button" aria-label="{{ctx.Locale.Tr "repo.diff.comment.add_line_comment"}}" class="ui primary button add-code-comment add-code-comment-{{if $line.RightIdx}}right{{else}}left{{end}}{{if (not $line.CanComment)}} tw-invisible{{end}}" data-side="{{if $line.RightIdx}}right{{else}}left{{end}}" data-idx="{{if $line.RightIdx}}{{$line.RightIdx}}{{else}}{{$line.LeftIdx}}{{end}}">{{/*
						*/}}{{svg "octicon-plus"}}{{/*
					*/}}</button>{{/*
				*/}}{{end}}{{/*
				*/}}{{if $line.RightIdx}}{{template "repo/diff/section_code" dict "diff" $inlineDiff}}{{else}}{{/*
					*/}}<code class="code-inner"></code>{{/*
				*/}}{{end}}{{/*
			*/}}</td>
		{{end}}
	</tr>
	{{if $line.Comments}}
		<tr class="add-comment" data-line-type="{{.GetHTMLDiffLineType}}">
		 <td class="add-comment-right" colspan="5">
		 	{{template "repo/diff/conversation" dict "." $ "comments" $line.Comments}}}
		 </td>
		</tr>
	{{end}}
	{{end}}
{{else}}
	{{range $k, $line := $.section.Lines}}
	{{$inlineDiff := $.section.GetComputedInlineDiffFor $line ctx.Locale}}
	<tr class="{{.GetHTMLDiffLineType}}-code nl-{{$k}} ol-{{$k}} line-expanded">
		{{if eq .GetType 4}}
			{{$expandDirection := $line.GetExpandDirection}}
			<td colspan="2" class="lines-num">
				<div class="lines-comment">
        	    	<div>
        	    	  {{if $line.SectionInfo.HasComments}}
        	    	  	<button>
        	    	  		{{svg "octicon-comment-discussion"}}
        	    	  	</button>
        	    	  {{end}}
        	    	</div>
					<div class="code-expander-buttons" data-expand-direction="{{$expandDirection}}">
						{{if or (eq $expandDirection 3) (eq $expandDirection 5)}}
							<button class="code-expander-button" hx-target="closest tr" hx-get="{{$.RepoLink}}/blob_excerpt/{{PathEscape $.AfterCommitID}}?{{$line.GetBlobExcerptQuery}}&style=unified&direction=down&wiki={{$.PageIsWiki}}&pull={{$.PageIsPullFiles}}&anchor={{$.Anchor}}&file_name={{$.section.FileName}}">
								{{svg "octicon-fold-down"}}
							</button>
						{{end}}
						{{if or (eq $expandDirection 3) (eq $expandDirection 4)}}
							<button class="code-expander-button" hx-target="closest tr" hx-get="{{$.RepoLink}}/blob_excerpt/{{PathEscape $.AfterCommitID}}?{{$line.GetBlobExcerptQuery}}&style=unified&direction=up&wiki={{$.PageIsWiki}}&pull={{$.PageIsPullFiles}}&anchor={{$.Anchor}}&file_name={{$.section.FileName}}">
								{{svg "octicon-fold-up"}}
							</button>
						{{end}}
						{{if eq $expandDirection 2}}
							<button class="code-expander-button" hx-target="closest tr" hx-get="{{$.RepoLink}}/blob_excerpt/{{PathEscape $.AfterCommitID}}?{{$line.GetBlobExcerptQuery}}&style=unified&direction=&wiki={{$.PageIsWiki}}&pull={{$.PageIsPullFiles}}&anchor={{$.Anchor}}&file_name={{$.section.FileName}}">
								{{svg "octicon-fold"}}
							</button>
						{{end}}
					</div>
			 	</div>	
			</td>
		{{else}}
			<td class="lines-num lines-num-old" data-line-num="{{if $line.LeftIdx}}{{$line.LeftIdx}}{{end}}"><span rel="{{if $line.LeftIdx}}diff-{{$.FileNameHash}}L{{$line.LeftIdx}}{{end}}"></span></td>
			<td class="lines-num lines-num-new" data-line-num="{{if $line.RightIdx}}{{$line.RightIdx}}{{end}}"><span rel="{{if $line.RightIdx}}diff-{{$.FileNameHash}}R{{$line.RightIdx}}{{end}}"></span></td>
		{{end}}
		<td class="lines-escape">{{if $inlineDiff.EscapeStatus.Escaped}}<button class="toggle-escape-button btn interact-bg" title="{{template "repo/diff/escape_title" dict "diff" $inlineDiff}}"></button>{{end}}</td>
		<td class="lines-type-marker"><span class="tw-font-mono" data-type-marker="{{$line.GetLineTypeMarker}}"></span></td>
		<td class="lines-code{{if (not $line.RightIdx)}} lines-code-old{{end}}">
			{{if and $.SignedUserID $.PageIsPullFiles}}
				<button type="button" aria-label="{{ctx.Locale.Tr "repo.diff.comment.add_line_comment"}}" class="ui primary button add-code-comment add-code-comment-{{if $line.RightIdx}}right{{else}}left{{end}}{{if (not $line.CanComment)}} tw-invisible{{end}}" data-side="{{if $line.RightIdx}}right{{else}}left{{end}}" data-idx="{{if $line.RightIdx}}{{$line.RightIdx}}{{else}}{{$line.LeftIdx}}{{end}}">
					{{svg "octicon-plus"}}
				</button>
			{{end}}
			<code {{if $inlineDiff.EscapeStatus.Escaped}}class="code-inner has-escaped" title="{{template "repo/diff/escape_title" dict "diff" $inlineDiff}}"{{else}}class="code-inner"{{end}}>
				{{$inlineDiff.Content}}
			</code>
		</td>	
	</tr>
	{{if $line.Comments}}
		<tr class="add-comment" data-line-type="{{.GetHTMLDiffLineType}}">
			<td class="add-comment-right" colspan="5">
				{{template "repo/diff/conversation" dict "." $ "comments" $line.Comments}}
			</td>
		</tr>
	{{end}}
	{{end}}
{{end}}
